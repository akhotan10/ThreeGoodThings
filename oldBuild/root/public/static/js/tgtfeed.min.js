var pageNum=0,hasNextPage=true,baseUrl="/api/things/",loadOnScroll=function(){if($(window).scrollTop()>$(document).height()-($(window).height()*3)){$(window).unbind();loadItems()}},myGoodThingTemplateMarkup="<div class='myGoodThing'><div class='avatar'><img src='http://graph.facebook.com/${fbuid}/picture?type=square' alt='${user}'/></div><a class='posted' href='/user/${username}/${id}' title='${posted}'>${postedreadable}</a><div class='controls'><a href='#' title='${id}' class='delete'>Delete</a><span class='cheercount'>${cheers} cheers</span><span class='commentcount'><a href='/user/${username}/${id}'><fb:comments-count href='http://www.threegthings.net/user/${username}/${id}'></fb:comments-count></a></span></div><div class='poster'><a href='/user/${username}'>${user}</a></div><div class='gt'>${goodThing}</div><div class='reason'>${reason}</div></div>",myGoodThingPrivateTemplateMarkup="<div class='myGoodThing'><div class='avatar'><img src='http://graph.facebook.com/${fbuid}/picture?type=square' alt='${user}'/></div><a class='posted' href='/user/${username}/${id}' title='${posted}'>${postedreadable}</a><div class='controls'><a href='#' title='${id}' class='delete'>Delete</a><span class='privacy'>${publicreadable}</span></div><div class='poster'><a href='/user/${username}'>${user}</a></div><div class='gt'>${goodThing}</div><div class='reason'>${reason}</div></div>",GoodThingTemplateMarkup="<div class='goodThing'><div class='avatar'><img src='http://graph.facebook.com/${fbuid}/picture?type=square' alt='${user}'/></div><a class='posted' href='/user/${username}/${id}' title='${posted}' name='posted${id}'>${postedreadable}</a><div class='controls'><span class='cheercount'><span id='cheers${id}'>${cheers}</span> cheers (<a id='${uncheer}cheer${id}' class='${uncheer}cheer' href='#posted${id}' title='${id}'>${uncheer}Cheer</a>)</span><span class='commentcount'><a href='/user/${username}/${id}'><fb:comments-count href='http://www.threegthings.net/user/${username}/${id}'></fb:comments-count></a></span></div><div class='poster'><a href='/user/${username}'>${user}</a></div><div class='gt'>${goodThing}</div><div class='reason'>${reason}</div></div>",singleUserThingTemplateMarkup="<div class='singleUserGoodThing'><a class='posted' href='/user/${username}/${id}' title='${posted}'>${postedreadable}</a><div class='gt'>${goodThing}</div><div class='metadata'><span class='cheercount'><span id='cheers${id}'>${cheers}</span> cheers <span class='cheerlink'>(<a id='${uncheer}cheer${id}' class='${uncheer}cheer' href='#' title='${id}'>${uncheer}Cheer</a>)</span></span><span class='commentcount'><a href='/user/${username}/${id}'><fb:comments-count href='http://www.threegthings.net/user/${username}/${id}'></fb:comments-count></a></span></div></div></div>";$.template("myGoodThingTemplate",myGoodThingTemplateMarkup);$.template("myGoodThingPrivateTemplate",myGoodThingPrivateTemplateMarkup);$.template("GoodThingTemplate",GoodThingTemplateMarkup);$.template("singleUserThingTemplate",singleUserThingTemplateMarkup);function updateFeed(){$("a.posted").each(function(a){$(this).html(relativeDate($(this).attr("title")))})}function renderGoodThing(a){a.postedreadable=relativeDate(a.posted);if(feedSelector!=""){return $.tmpl("singleUserThingTemplate",[a])}else{if(a["public"]==true){a.publicreadable="Public"}else{a.publicreadable="Private"}if(a.uid==uid){if(a.publicreadable!="Public"){return $.tmpl("myGoodThingPrivateTemplate",[a])}else{return $.tmpl("myGoodThingTemplate",[a])}}else{return $.tmpl("GoodThingTemplate",[a])}}}function loadItems(){if(hasNextPage===false){return false}pageNum=pageNum+1;var a=baseUrl+"?page="+pageNum+feedSelector;$.ajax({url:a,dataType:"json",success:function(b){hasNextPage=b.hasNext;$.each(b.itemList,function(c,d){renderGoodThing(d).appendTo("#goodThingsList")})},complete:function(b,c){$(".myGoodThing").hover(function(){$(this).children(".controls").children(".delete").fadeIn(150)},function(){$(this).children(".controls").children(".delete").fadeOut(150)});if($("#filter_you").hasClass("filter_selected")){filterYou()}FB.XFBML.parse();$(window).bind("scroll",loadOnScroll)}})}function tgtDocumentReady(){loadItems();$(window).bind("scroll",loadOnScroll);$(document).on("click","a.delete",function(){$.post("/api/delete",{gtid:$(this).attr("title"),csrfmiddlewaretoken:csrfmiddlewaretoken});$(this).parents(".myGoodThing").hide(300,function(){$(this).remove()});$("#gtcount").html(Number($("#gtcount").html())-1)});$(document).on("click","a.cheer",function(){$.post("/api/cheer",{gtid:$(this).attr("title"),csrfmiddlewaretoken:csrfmiddlewaretoken},function(a){$("#cheer"+a).replaceWith('<a id="uncheer'+a+'" class="uncheer" href="#" title="'+a+'">unCheer</a>')})});$(document).on("click","a.uncheer",function(){$.post("/api/uncheer",{gtid:$(this).attr("title"),csrfmiddlewaretoken:csrfmiddlewaretoken},function(a){$("#uncheer"+a).replaceWith('<a id="cheer'+a+'" class="cheer" href="#" title="'+a+'">Cheer</a>')})});setInterval("updateFeed()",5000)};